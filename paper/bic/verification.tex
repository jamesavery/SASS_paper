\section{Verification and analysis}
\label{sec:verification}

In this section, we present the verification of the segmentation method
described in \Cref{sec:method}. We first qualitatively verify the method by
comparing the segmentation results to the original tomography. We then
quantitatively verify the method by generating synthetic data, creating ground
truth, and comparing the results to other methods. Finally, we analyze the
segmented data to study the blood vessel network in the bone region and produce
statistics on the tissue-to-implant contact.

\subsection{Qualitative verification}

% TODO In case of ground truth; rephrase to "We first qualitatively verify the method by comparing the segmentation results to the ground truth. We then quantitatively verify the method by generating synthetic data, creating ground truth, and comparing the results to other methods."

Since the SRµCT tomograms are clear enough that humans can distinguish between
blood vessels and bone, as our mammalian visual cortex automatically corrects
for the distortion effects, we can verify the success of the automatic
classification. We can compare the automatic classification with the manual
classification of the histological microscopy. A larger quantitative study is
planned that analyses the full data set against recently conducted histological
microscopy taken from the same biopsies. As such, we can only present a
qualitative verification of the method in this paper.

Figures \Cref{fig:histology-comparison1} and \Cref{fig:histology-comparison2}
show the same 2D slices as were shown in Figures \Cref{fig:3viewsample} and
\Cref{fig:slices}, allows us to visually inspect them side by side. The voxels
are colored according to the segmentation confidence, with the degree of red
being proportional to the modeled probability $\Pof{0}{v,\fval}$ and the degree
of yellow being proportional to $\Pof{1}{v,\fval}$. Grey voxels indicate low
model probabilities of both: either due to the voxel belonging to another
material or simply low computed confidence of the model. By comparing Figures
\Cref{fig:histology-comparison1} and \Cref{fig:histology-comparison2}, we see
that the computed classification matches the human classification everywhere
where it is possible to visually distinguish the voxels.

\begin{figure*}
    \centering
    \begin{tabular}{cc}
        \includegraphics[width=.45\linewidth]{generated/770c_pag_segmented_yx_raw.pdf} &
        \\
        \includegraphics[width=.45\linewidth]{generated/770c_pag_segmented_yx_colored.pdf} &
        \includegraphics[width=.45\linewidth]{generated/770c_pag_global_yx.pdf} \\
    \end{tabular}
    \caption{
        YX slices of the original tomography (top left), our classification
        (bottom left), and global threshold classification (bottom right). For
        our classification, the voxels are colored according to the modeled
        probability functions $P(m\vert v,\fval)$ between 0 and 1: completely
        red voxels have $P(m=0\vert v,\fval) = 1$, completely yellow voxels
        have $P(m=1\vert v,\fval)\ = 1$, and uncertain voxels become
        progressively gray.
    }
    \label{fig:histology-comparison1}
\end{figure*}

\begin{figure*}
    \centering
    \begin{tabular}{cc}
        \includegraphics[width=.45\linewidth]{generated/770c_pag_segmented_zy_raw.pdf} &
        \\
        \includegraphics[width=.45\linewidth]{generated/770c_pag_segmented_zy_colored.pdf} &
        \includegraphics[width=.45\linewidth]{generated/770c_pag_global_zy.pdf} \\
    \end{tabular}
    \caption{
        YZ slices of the original tomography (top left), our classification
        (bottom left), and global threshold classification (bottom right).
        Yellow depicts bone and red depicts soft tissue. Note that our
        segmentation correctly classifies the materials close to the implant,
        even in the grooves of the screw threads, whereas the global threshold
        classification fails.
    }
    \label{fig:histology-comparison2}
\end{figure*}

We see that the segmentation is overall successful, classifying the internal
darker regions as soft tissue and the lighter regions as bone. This is further
confirmed in \Cref{sec:blood-network}. However, extremely close to the implant
(a few voxels), we cannot verify the segmentation, as the voxel values are so
blended together with the implant voxel values that they become
indistinguishable. A further strengthening of the analysis is needed to reach
this layer. It is possible that the information is irretrievably lost, or
perhaps it can be retrieved through a deconvolution - or simply a more precise
version of the present analysis. It also fails within some of the soft tissue
blobs, which is due to air bubbles in the resin, which have a very low density
and thus a very low absorption.



\subsection{Quantitative verification}
\subsubsection{Generating synthetic data}
\subsubsection{Ground truth generation}
\subsubsection{Comparison to other methods}
Global thresholding
Classic CV
ML-based methods

\subsection{Dataset analysis}

% TODO better seque
Having verified the method qualitatively and quantitatively, we can now analyze
the segmented data. We are interested in the blood vessel network in the bone
region and the tissue-to-implant contact. We will first analyze the blood
vessel network and then the tissue-to-implant contact.

\subsubsection{Blood vessel network}
\label{sec:blood-network}

With a good separation of soft tissue and bone, we map out the blood vessel
network using connected components analysis, which is visualized in the 3D
renders in~\Cref{fig:blood-network}. Here we see that we have successfully
segmented the blood vessels out of the bone region. It is especially prominent
when looking at the capillary network, as we can see these in fine detail.
Noteworthy, the newly formed bone region (\Cref{fig:blood-new-slice}) contains
larger concentrations of small blood vessels, compared to the old bone
(\Cref{fig:blood-old-slice}). If we zoom in on a small cube region
(\Cref{fig:blood-old-cube} and \Cref{fig:blood-new-cube}), we see it even more
defined, clearly seeing how the larger vessels connect through the smaller
ones.

\begin{figure}
    \centering
    \begin{subfigure}[b]{\linewidth}
    \centering
        \includegraphics[width=.7\linewidth]{generated/figure10_old_bone.png}
        % TODO opdater hvis en anden slice størrelse bliver brugt. voxel size = 3.75
        \caption{A $375\mu m \times 4230\mu m \times 6480\mu m$ slice of the blood network in the old bone region.}
        \label{fig:blood-old-slice}
    \end{subfigure}
    \begin{subfigure}[b]{\linewidth}
    \centering
        \includegraphics[width=.7\linewidth]{generated/figure10_new_bone.png}
        \caption{A $375\mu m \times 4230\mu m \times 6480\mu m$ slice of the blood network in the new bone region.}
        \label{fig:blood-new-slice}
    \end{subfigure}
    \begin{subfigure}[b]{.48\linewidth}
    \centering
        \includegraphics[width=.9\linewidth,height=\linewidth]{generated/figure10_old_cube.png}
        \caption{A $1mm \times 1 mm \times 1 mm$ cube of the blood network in the old bone region.}
        \label{fig:blood-old-cube}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{.48\linewidth}
    \centering
        \includegraphics[width=.9\linewidth,height=\linewidth]{generated/figure10_new_cube.png}
        \caption{A $1mm \times 1 mm \times 1 mm$ cube of the blood network in the new bone region.}
        \label{fig:blood-new-cube}
    \end{subfigure}
    \caption{
        3D renders of the blood network. We see a difference between the
        capillary network in the old bone region
        (\ref{fig:blood-old-slice},\ref{fig:blood-old-cube}) compared to the
        newly grown bone region
        (\ref{fig:blood-new-slice},\ref{fig:blood-new-cube}), where the new
        bone region contains a higher concentration of small blood vessels,
        compared to the old bone region containing fewer larger blood vessels.
    }
    \label{fig:blood-network}
\end{figure}

\subsubsection{Implant contact}
\label{sec:contact}

Tissue in contact with the implant can be studied using the EDT from the
implant, restricted to the bone region. We can simply mask the voxels that are
within a thin shell of distances, $d_{min} < d(x,y,z) \le d_{max}$, for
example, $d_{min} = 1 \text{µm}$ to $d_{max} = 5 \text{µm}$. We then sum over
the masked voxels of each tissue type to obtain and divide by the total to
obtain the tissue-to-implant contact per area or study the distribution across
the surface area qualitatively. In particular, we are interested in the
difference between the old and new bone regions. We define the metric as
follows:

\begin{equation}
    BIC = \frac{\sum_{i : \text{field}(i) < 5} \text{bone}(i)}{\sum_{i : \text{field}(i) < 5} \text{voxels}(i)}
\end{equation}

We find the old and new bone regions at different $z$ levels, based on the
threading of the implant, with new bone being near the small threads and old
bone being near the large threads. The results can be seen in \Cref{tab:bic}.
We see that the BIC is higher in the old bone region than in the new bone
region, which is expected as the bone grows around the implant over time. This
is further confirmed by the blood vessel network analysis, as the new bone
region contains a higher concentration of small blood vessels, indicating that
the bone is still growing. This shows that the method is successful in
segmenting the bone and soft tissue regions and that the segmentation can be
used to study BIC.

\begin{table}
    \caption{The mean and standard deviation of bone-to-implant contact in the old and new bone regions for each of our samples.}
    \label{tab:bic}
    \centering
    \begin{tabular}{lcc}
        \toprule
        Sample & Old bone & New bone \\
        \midrule
        770\_pag & $0.5020 \pm 0.1222$ & - \\
        770c\_pag & $0.6519 \pm 0.1055$ & $0.5638 \pm 0.0907$ \\
        771c\_pag & $0.4517 \pm 0.1708$ & $0.5016 \pm 0.1078$ \\
        772\_pag & $0.7012 \pm 0.1065$ & $0.5222 \pm 0.0869$ \\
        775c\_pag & $0.2802 \pm 0.0928$ & $0.2652 \pm 0.1054$ \\
        810c\_pag & $0.6819 \pm 0.0866$ & $0.5155 \pm 0.0897$ \\
        811\_pag & $0.5832 \pm 0.1015$ & $0.3715 \pm 0.0935$ \\
        \bottomrule
    \end{tabular}
\end{table}

